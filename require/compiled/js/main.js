define("js/global",["require"],function(e){return window}),define("js/storage",["require","exports","module","./global"],function(e,t,n){function o(e){return typeof e=="string"?e:i.stringify(e)}function u(e){return e?i.parse(e):e}var r=e("./global"),i=r.JSON,s=r.localStorage;s&&i?(t.supported=!0,t.has=function(e){return typeof s.getItem(e)=="string"},t.get=function(e){return u(s.getItem(e))},t.set=function(e,t){s.setItem(e,o(t))},t.remove=function(e){s.removeItem(e)}):t.supported=!1}),define("js/events",["require","exports","module"],function(e,t,n){function r(){var e=[];this.subscribe=function(t){typeof t=="function"&&e.push(t)},this.unsubscribe=function(t){if(typeof t!="function")return;var n=-1;for(var r=0,i=e.length;r<i;r++)if(e[r]===t){n=r;break}n>-1&&e.splice(n,1)},this.emit=function(){for(var t=0,n=e.length;t<n;t++)e[t].apply(this,Array.prototype.slice.call(arguments,0))}}function i(){var e={};this.emit=function(t){t&&e[t]&&e[t].emit.apply(this,Array.prototype.slice.call(arguments,1))},this.on=function(t,n){e[t]=e[t]||new r,e[t].subscribe(n)},this.off=function(t,n){e[t]&&e[t].unsubscribe(n)}}function s(e){var t=[],n=!1,r=[];if(typeof e!="function"){console.error("Promise condition should be a function"),n=!!e;return}this.check=function(){if(n)return;var i=Array.prototype.slice.call(arguments,0);if(e.apply(this,i)){n=!0,r=i;for(var s=0,o=t.length;s<o;s++)t[s].apply(this,i)}},this.success=function(e){if(!typeof e==="function")return;n?e.apply(this,r):t.push(e)}}t.Event=r,t.Emitter=i,t.Promise=s,t.Bus=new i}),define("js/model-factory",["require","exports","module","./events"],function(e,t,n){function s(e,t){return function(){t.apply(e,Array.prototype.slice.call(arguments,0))}}function o(e){return(e<10?"0":"")+e}function u(e){return e.getFullYear()+"-"+o(e.getMonth()+1)+"-"+o(e.getDate())}function f(e){var t=a.exec(e);if(t===null||t.length<4)return console.log("failed to parse an ISO date from ",e),undefined;var n=parseInt(t[1]),r=parseInt(t[2].replace(/^0*/,""))-1,i=parseInt(t[3].replace(/^0*/,""));return!n||!r||!i?(console.log("failed to parse an ISO date from ",e),undefined):new Date(n,r,i,0,0,0,0)}function l(e){var t=new Date(e),n=t.getDay();return t.setDate(t.getDate()-(n?n:7)+1),t}function c(e){var t=new Date(e),n=t.getDay();return n&&t.setDate(t.getDate()-n+7),t}function p(e){this.isoDate=u(e),this.display={day:h[e.getDay()],date:e.getDate()+"."+o(e.getMonth()+1)},this.lectures=[];var t=new r.Emitter;this.on=s(this,t.on),this.emit=s(this,t.emit),this.off=s(this,t.off)}function d(e){var t=this.monday=l(e),n=this.sunday=c(e),r=this.days=[];for(var i=new Date(t);i<=n;i.setDate(i.getDate()+1))r.push(new p(i))}function v(e){function c(e){e.date||console.error("can't add a lecture without date!");var t=p(e.date),n=t.add(e);l("lecture.add",e,t,n)}function h(e){e.date||console.error("can't remove lecture without a date!");var t=p(e.date),n=t.remove(e);l("lecture.remove",e,t,n)}function p(e){var t=f(e),r;if(!o&&!u)r=v(t);else{while(o>t)r=m();while(u<t)r=g();if(!r){var i=0;do r=n[i++];while(!r.contains(t))}}return r&&r.day(t)}function v(e){var t=new d(e);return n.push(t),o=new Date(t.monday),u=new Date(t.sunday),l("week.append",t),t}function m(){o.setDate(o.getDate()-7);var e=new d(o);return n.splice(0,0,e),l("week.prepend",e),e}function g(){u.setDate(u.getDate()+7);var e=new d(u);return n.push(e),l("week.append",e),e}function b(){y.weeks=n=[],o=u=undefined,l("clear")}function w(e){n.length&&b();var t=l;l=function(){};if(e&&e.length)for(var r=0,s=e.length;r<s;r++)c(e[r]);if(i&&i.viewport){n.length||v(new Date);while(n.length<i.viewport)g()}l=t,l("init")}function E(){var e=[];for(var t=0,r=n.length;t<r;t++)for(var i=0,s=n[t].days.length;i<s;i++)for(var o=0,u=n[t].days[i].lectures.length;o<u;o++)e.push(n[t].days[i].lectures[o]);return e}var t=[],n=[],o,u,a=new r.Emitter,l=s(this,a.emit),y=this;this.weeks=n,this.appendWeek=g,this.prependWeek=m,this.lectures=E,this.add=c,this.remove=h,this.init=w,this.on=s(this,a.on),this.off=s(this,a.off),w(e)}var r=e("./events"),i=n.config(),a=/\s*(\d+)-(\d+)-(\d+)\s*/,h=["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"];p.prototype.add=function(e){var t=this.lectures,n=t.length,r=0;while(r<n&&t[r].start<e.start)r++;return t.splice(r,0,e),this.emit("add",r,e),r},p.prototype.remove=function(e){var t=this.lectures,n=t.length,r=0;while(r<n&&t[r]!==e)r++;return r<n?(this.emit("remove",r,t.splice(r,1)),r):-1},d.prototype.contains=function(e){return this.monday<=e&&this.sunday>=e},d.prototype.day=function(e){if(this.contains(e))return this.days[(e.getDay()+6)%7]},t.Model=v}),define("js/ui/forms",["require","exports","module","jquery"],function(e,t,n){function r(e,t){var n={required:function(){return"Поле является обязательным"},format:function(e){return"Формат для поля : "+e},"default":function(e){return e}};return{name:t,message:n[n[e]?e:"default"].apply(this,Array.prototype.slice.call(arguments,2))}}function i(e,t,n){this.container=e;var r={},o=this;$.each(t,function(e,t){var n=new s(o,e,t);n.element.length&&(r[e]=n)}),typeof n=="function"&&(this.validate=function(){return i.prototype.validate.call(this).concat(n.call(this))}),o.fields=r}function s(e,t,n){this.name=t,this.element=e.container.find("[name="+t+"]");if(!n&&!this.element)return;n.required&&(this.required=!0),$.isFunction(n.init)&&n.init.call(this),$.isFunction(n.get)&&(this.get=n.get),$.isFunction(n.set)&&(this.set=n.set),$.isFunction(n.validate)&&(this.validate=function(){return s.prototype.validate.call(this).concat(n.validate.call(this))})}$=e("jquery"),i.prototype.get=function(){var e={};return $.each(this.fields,function(t,n){e[t]=n.get()}),e},i.prototype.bind=function(e){var t=this;$.each(this.fields,function(e,t){t.set("")}),e&&typeof e=="object"&&$.each(e,function(n,r){t.fields[n]&&t.fields[n].set(e[n])})},i.prototype.validate=function(){var e=[];return $.each(this.fields,function(t,n){e=e.concat(n.validate())}),e},s.prototype.get=function(){return this.element.val()},s.prototype.set=function(e){this.element.val(e)},s.prototype.validate=function(){return this.required&&!this.get()?[new r("required",this.name)]:[]},t.Form=i,t.Error=r}),define("js/templates",["require","exports","module","handlebars","./events"],function(e,t,n){function u(e){if(!Handlebars){console.error("Handlebars is missing from the global scope");return}var n,r={"(":"{",")":"}"};while(n=o.exec(e))for(var i=0,u=n.length;i<u;i++)t[n[1]]=Handlebars.compile(n[2].replace(/[\(\)]/g,function(e){return r[e]||e})),s.check()}e("handlebars");var r=e("./events"),i=n.config().required,s=new r.Promise(function(){if(!i&&!i.length)return!0;for(var e=0,n=i.length;e<n;e++)if(!t[i[e]])return!1;return!0}),o=/<!--\s*([\w$-]+)\s*-->\s*([\s\S]+?)\s*(?=<!--\s*[\w$-]+\s*-->|$)/g;e(["text!templates/templates.html"],function(e){e&&u(e)}),t.ready=s}),define("js/ui/dialog",["require","exports","module","jquery","./forms","js/events","js/templates","jquery-ui.ru"],function(e,t,n){function l(e,t,n){var s={autoOpen:!1,modal:!0,resizable:!1,width:"auto",maxWidth:600,dialogClass:"b-dialog"},o={};return o.dlg=r(e).dialog(r.extend(!0,s,t)),o.form=new i.Form(o.dlg,n),o}function c(e){return parseInt(e.replace(/^0/,""))}function p(){var e=this.get();if(!e)return[];var t=h.exec(e);return!t||!t.length?[new i.Error("format",this.name,"[http|https|ftp]://...")]:[]}function d(){return r.trim(this.element.val())}function v(){var e=/^\s*([0-2]\d):([0-5]\d)\s*$/.exec(this.get());return e?[]:[new i.Error("format",this.name,"hh:mm")]}function b(e,t){var n=e.form,i=n.validate();i.length?r.each(i,function(e,t){var r=n.fields[t.name].element,i=r.closest(".b-form__field");i.addClass(g).find(y).text(t.message),r.one("focus",function(e){i.removeClass(g).find(y).text("")})}):(r.isFunction(t)&&t(n.get()),e.dlg.dialog("close"))}function w(e){r.isFunction(e)&&e(),r(this).dialog("close")}function E(e,t,n){f(function(){e.form.bind(t),e.dlg.dialog("option",n).dialog("open")})}var r=e("jquery"),i=e("./forms"),s=e("js/events"),o=e("js/templates");e("jquery-ui.ru");var u,a,f=o.ready.success;r.widget("ui.timespinner",r.ui.spinner,{options:{min:0,max:1439,step:1,page:60},_parse:function(e){if(typeof e=="string"){var t=/^\s*([0-2]\d):([0-5]\d)\s*$/.exec(e);if(t){var n=this._int(t[1]),r=this._int(t[2]);if(!isNaN(n)&&!isNaN(r))return n*60+r}}else if(typeof e=="number")return e},_format:function(e){return this._topzero(~~(e/60))+":"+this._topzero(e%60)},_topzero:function(e){return(e<10?"0":"")+e},_int:c});var h=/^\s*(?:https?|ftp):\/\/.+/,m={date:{required:!0,init:function(){this.element.datepicker({showButtonPanel:!0,showOn:"button",dateFormat:"yy-mm-dd"})}},start:{required:!0,init:function(){this.element.timespinner()},validate:v},end:{required:!0,init:function(){this.element.timespinner()},validate:v},title:{required:!0,get:d},person:{required:!0,get:d},points:{get:d},presentation:{get:d,validate:p},video:{get:d,validate:p}},g="b-form__field_state_invalid",y=".b-form__field-error-message";f(function(){u=l(o["dialog-change"](),{},m),a=l(o["dialog-textdata"](),{resizable:!0,width:"auto",maxWidth:1e3},{data:{}})}),t.create=function(e,t,n){E(u,t,{title:"Новая лекция",buttons:[{text:"ОК",click:function(){b(u,n)}},{text:"Отмена",click:w}]})},t.change=function(e,t,n,r){E(u,t,{title:"Изменить информацию",buttons:[{text:"ОК",click:function(){b(u,n)}},{text:"Отмена",click:w},{text:"Удалить",click:function(){w.call(this,r)}}]})},t.getJSON=function(e){E(a,{},{title:"Создать из JSON",buttons:[{text:"ОК",click:function(){b(a,e)}},{text:"Отмена",click:w}]})},t.provideJSON=function(e){E(a,{data:e},{title:"Расписание в формате JSON",buttons:[{text:"ОК",click:w}]})}}),define("js/ui/layout",["require","exports","module","jquery","js/templates","js/events"],function(e,t,n){function a(e,t){var n=r(i.day(t)),s=n.find(".b-curriculum__lectures-list");_dayLectures[t.isoDate]=s,r.each(t.lectures,function(e,t){u.add(s,t,-1)}),e.append(n),o.emit.call(n,"new.day",t)}function f(e,t,n){n=n||"append";var s=r(i.week(t));r.each(t.days,function(e,t){a(s,t)}),e[n](s),o.emit.call(s,"new.week",t)}function l(e,t){r.each(t.weeks,function(t,n){f(e,n)}),o.emit.call(e,"init",t)}function p(e){i.ready.success(function(){if(!e.weeks.length)return;if(!h||!h["static"])e.on("clear",function(){_dayLectures=[],c.empty(),o.emit.call(c,"clear")}),e.on("init",function(){l(c,this)}),e.on("week.prepend",function(e){f(c,e,"prepend")}),e.on("week.append",function(e){f(c,e,"append")}),e.on("lecture.add",function(e,t,n){u.add(_dayLectures[t.isoDate],e,n)}),e.on("lecture.remove",function(e,t,n){u.remove(_dayLectures[t.isoDate],e,n)});l(c,e)})}var r=e("jquery"),i=e("js/templates"),s=e("js/events"),o=new s.Emitter,u={add:function(e,t,n){var s=r(i.lecture(t)),u=e.children();return n>=0&&n<u.length?r(u[n]).before(s):e.append(s),o.emit.call(s,"new.lecture",t),s},remove:function(e,t,n){var i=e.children();n>=0&&n<=i.length&&(r(i[n]).remove(),o.emit.call(e,"removed.lecture",t))}};_dayLectures={};var c=r(".b-curriculum"),h=n.config();t.init=p,t.on=o.on,t.off=o.off}),define("js/files",["require","exports","module","./global"],function(e,t,n){function o(e){var t=new s;t.append(e);var n=t.getBlob("application/octet-stream");return i.createObjectURL(n)}var r=e("./global"),i=r.URL||r.webkitURL,s=r.BlobBuilder||r.WebKitBlobBuilder||r.MozBlobBuilder||r.MSBlobBuilder;this.supported=i&&s,this.href=o}),define("js/ui/interaction",["require","exports","module","jquery","jquery-ui","./dialog","js/storage","./layout","js/files"],function(e,t,n){function f(e){a||(a=!0,e(),a=!1)}function l(e){var t=r(".b-menu"),n={save:t.find(".b-menu__menu-item_command_save"),load:t.find(".b-menu__menu-item_command_load"),print:t.find(".b-menu__menu-item_command_print"),upload:t.find(".b-menu__menu-item_command_upload"),download:t.find(".b-menu__menu-item_command_download")};r.each(n,function(){r(this).button()}),n.save.button("disable"),n.load.button("disable"),s.supported&&(n.save.click(function(t){f(function(){s.set("modeldata",e.lectures())})}),n.load.click(function(t){f(function(){var t=s.get("modeldata");t&&t.length&&e.init(t)})}),n.print.click(function(t){f(function(){s.set("modeldata",e.lectures())})}));var o=!1,a=function(){!o&&s.supported&&(n.save.button("enable"),n.load.button("enable"),o=!0)};e.on("lecture.add",a),e.on("lecture.remove",a),e.on("init",function(){n.save.removeClass("ui-state-hover").button("disable"),n.load.removeClass("ui-state-hover").button("disable"),o=!1}),JSON&&(n.upload.click(function(){i.getJSON(function(t){var n;try{n=JSON.parse(t.data)}catch(r){n=""}n&&n.length&&f(function(){e.init(n)})})}),n.download.click(function(t){var r=JSON.stringify(e.lectures()||"");r&&f(function(){if(u.supported){var s=n.download;s.attr("download","model.json"),s.attr("href",u.href(r))}else t.preventDefault(),i.provideJSON(JSON.stringify(e.lectures()||""))})}))}function c(e){r(".b-content__workspace-control_action_prepend").click(function(){e.prependWeek()}),r(".b-content__workspace-control_action_append").click(function(){e.appendWeek()})}var r=e("jquery");e("jquery-ui");var i=e("./dialog"),s=e("js/storage"),o=e("./layout"),u=e("js/files"),a=!1;t.init=function(e){r(function(){o.on("new.day",function(t){this.click(function(){var n={date:t.isoDate,start:t.lectures.length?t.lectures[t.lectures.length-1].end:"12:00"};n.end=n.start.replace(/\d{2}:/,function(e){return parseInt(e)+1+":"}),i.create(this,n,function(t){e.add(t)})})}),o.on("new.lecture",function(t){this.on("click",".b-curriculum__lecture-action_remove",function(n){e.remove(t),n.stopPropagation()}),this.click(function(n){i.change(this,t,function(r){e.remove(t),e.add(r)},function(){e.remove(t)}),n.stopPropagation()})});var t=r(this.body);o.on("clear",function(){t.addClass("b-content_state_unloaded")}),o.on("init",function(){t.removeClass("b-content_state_unloaded")}),l(e),o.init(e),c(e)})}}),define("js/main",["require","exports","module","jquery","js/storage","js/global","js/model-factory","js/ui/interaction"],function(e,t,n){var r=e("jquery"),i=e("js/storage"),s=e("js/global"),o=e("js/model-factory"),u=e("js/ui/interaction"),a=i.get("modeldata");a=a||[{date:"2012-09-15",start:"12:00",end:"13:00",title:"Общий цикл разработки",person:"Миша Трошев (mishanga)",points:"Всем привет. Школу мы проводим впервые, поэтому хотим, чтобы не только мы помогали вам развиваться, но и наоборот. Мы планируем по каждой лекции собирать ваши замечания, понять понравился ли вам рассказ, как вы оцениваете лекторов. В опросе будут чекбоксы, но хотелось бы увидеть и развернутые ответы в комментариях.",presentation:"http://yadi.sk/d/VDsJ4ZUBiq6u",video:"http://static.video.yandex.ru/lite/ya-events/yb1ix4ck06.4829"},{date:"2012-09-15",start:"13:00",end:"14:00",title:"Системы ведения задач",person:"Сергей Бережной",points:"",presentation:"http://yadi.sk/d/D5xTwoIciq6c",video:""},{date:"2012-09-15",start:"14:00",end:"15:00",title:"Wiki",person:"Сергей Бережной (veged)",points:"",presentation:"http://yadi.sk/d/7F9PuECdiq6G",video:""},{date:"2012-09-18",start:"19:00",end:"20:00",title:"Командная строка Unix",person:"Виктор Ашик",points:"",presentation:"http://yadi.sk/d/3N0d6h9rlRA8",video:"http://static.video.yandex.ru/lite/ya-events/qxv95xwi4q.4820"},{date:"2012-09-18",start:"20:00",end:"21:00",title:"Редакторы \\ Средства разработки",person:"Вячеслав Олиянчук",points:"",presentation:"https://github.com/yandex-shri/lectures/blob/master/05-editors.md",video:"http://static.video.yandex.ru/lite/ya-events/h4kt5t9a07.4101"},{date:"2012-09-20",start:"19:00",end:"20:00",title:"Браузеры",person:"Георгий Мостоловица",points:"",presentation:"http://yadi.sk/d/-VjNYqjTqTca",video:"http://static.video.yandex.ru/lite/ya-events/hvbwev4zfw.3829"},{date:"2012-09-20",start:"20:00",end:"21:00",title:"Системы контроля версий",person:"Сергей Сергеев",points:"",presentation:"http://yadi.sk/d/a7aY8YXjr-hs",video:"http://static.video.yandex.ru/lite/ya-events/udxty33q8y.4106"},{date:"2012-09-22",start:"12:00",end:"13:00",title:"Тестирование",person:"Марина Широчкина",points:"",presentation:"http://yadi.sk/d/W7lDOetHqTWC",video:"http://static.video.yandex.ru/lite/ya-events/xc8acgglq0.1103"},{date:"2012-09-22",start:"13:00",end:"14:00",title:"Развертывание верстки",person:"Павел Пушкарев",points:"",presentation:"http://yadi.sk/d/N4FYrhS3qTSI",video:"http://static.video.yandex.ru/lite/ya-events/eh1gwaf93n.4603"},{date:"2012-09-22",start:"14:00",end:"15:00",title:"HTTP-протокол",person:"Алексей Бережной",points:"Любые сходства фамилий и внешности с другими лекторами НЕ являются случайными.",presentation:"http://yadi.sk/d/waP8x8maqTKM",video:"http://static.video.yandex.ru/lite/ya-events/pnqglhihpo.3500"},{date:"2012-09-24",start:"19:00",end:"21:00",title:"XML, XPath, XSLT",person:"Сергей Пузанков",points:"",presentation:"http://yadi.sk/d/PLpXM88frhSW",video:""},{date:"2012-09-25",start:"19:00",end:"20:00",title:"Механизм работы браузера",person:"Роман Комаров",points:"",presentation:"http://yadi.sk/d/wo1LfOGatbOM",video:""},{date:"2012-09-25",start:"20:00",end:"21:00",title:"Кеширование на клиенте и сервере",person:"Егор Львовский",points:"",presentation:"http://yadi.sk/d/EEEp53YstbNo",video:"http://static.video.yandex.ru/lite/ya-events/7c5917p3z8.4920/"},{date:"2012-09-27",start:"19:00",end:"20:00",title:"Безопасность веб-приложений",person:"Тарас Иващенко",points:"",presentation:"http://yadi.sk/d/bo1OpD2Av3vC",video:""},{date:"2012-09-27",start:"20:00",end:"21:00",title:"Языки программирования",person:"Алексей Воинов",points:"",presentation:"http://yadi.sk/d/LRpqvLuIv4UI",video:""},{date:"2012-09-29",start:"12:00",end:"13:00",title:"JS. Базовые знания",person:"Михаил Давыдов",points:"",presentation:"",video:""},{date:"2012-09-29",start:"13:00",end:"14:00",title:"Транспорт. AJAX",person:"Михаил Давыдов",points:"",presentation:"",video:""},{date:"2012-09-29",start:"14:00",end:"15:00",title:"JS. Асинхронность",person:"Михаил Давыдов",points:"",presentation:"",video:""},{date:"2012-10-02",start:"19:00",end:"20:00",title:"Отладка кода",person:"Алексей Андросов",points:"",presentation:"",video:""},{date:"2012-10-04",start:"19:00",end:"20:00",title:"Клиентская оптимизация",person:"Иван Карев",points:"",presentation:"",video:""},{date:"2012-10-04",start:"20:00",end:"21:00",title:"Profiler",person:"Михаил Корепанов",points:"",presentation:"",video:""},{date:"2012-10-06",start:"12:00",end:"13:00",title:"CSS",person:"Михаил Трошев (mishanga)",points:"",presentation:"",video:""},{date:"2012-10-06",start:"13:00",end:"14:00",title:"Регулярные выражения",person:"Максим Ширшин",points:"",presentation:"",video:""},{date:"2012-10-09",start:"19:00",end:"20:00",title:"Фреймворки. Обзор",person:"Алексей Андросов",points:"",presentation:"",video:""},{date:"2012-10-09",start:"20:00",end:"21:00",title:"jQuery",person:"Алексей Бережной",points:"",presentation:"",video:""},{date:"2012-10-11",start:"19:00",end:"20:00",title:"БЭМ. Теория",person:"Владимир Варанкин",points:"",presentation:"",video:""},{date:"2012-10-11",start:"20:00",end:"21:00",title:"БЭМ. Примеры",person:"Владимир Варанкин",points:"",presentation:"",video:""},{date:"2012-10-13",start:"12:00",end:"13:00",title:"Шаблонизаторы",person:"Сергей Бережной (veged)",points:"",presentation:"",video:""},{date:"2012-10-13",start:"13:00",end:"14:00",title:"Дизайн",person:"Константин Горский",points:"",presentation:"",video:""},{date:"2012-10-13",start:"14:00",end:"15:00",title:"Дизайн глазами разработчика",person:"Михаил Трошев (mishanga)",points:"",presentation:"",video:""},{date:"2012-10-14",start:"23:59",end:"00:00",title:"Сдаёмся!",person:"Все участники ШРИ",points:"",presentation:"",video:""}],u.init(new o.Model(a))})