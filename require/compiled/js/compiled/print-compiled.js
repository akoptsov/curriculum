define("js/events",["require","exports","module"],function(e,t,n){function r(){var e=[];this.subscribe=function(t){typeof t=="function"&&e.push(t)},this.unsubscribe=function(t){if(typeof t!="function")return;var n=-1;for(var r=0,i=e.length;r<i;r++)if(e[r]===t){n=r;break}n>-1&&e.splice(n,1)},this.emit=function(){for(var t=0,n=e.length;t<n;t++)e[t].apply(this,Array.prototype.slice.call(arguments,0))}}function i(){var e={};this.emit=function(t){t&&e[t]&&e[t].emit.apply(this,Array.prototype.slice.call(arguments,1))},this.on=function(t,n){e[t]=e[t]||new r,e[t].subscribe(n)},this.off=function(t,n){e[t]&&e[t].unsubscribe(n)}}function s(e){var t=[],n=!1,r=[];if(typeof e!="function"){console.error("Promise condition should be a function"),n=!!e;return}this.check=function(){if(n)return;var i=Array.prototype.slice.call(arguments,0);if(e.apply(this,i)){n=!0,r=i;for(var s=0,o=t.length;s<o;s++)t[s].apply(this,i)}},this.success=function(e){if(!typeof e==="function")return;n?e.apply(this,r):t.push(e)}}t.Event=r,t.Emitter=i,t.Promise=s,t.Bus=new i}),define("js/model-factory",["require","exports","module","./events"],function(e,t,n){function r(e,t){return function(){t.apply(e,Array.prototype.slice.call(arguments,0))}}function i(e){return(e<10?"0":"")+e}function s(e){return e.getFullYear()+"-"+i(e.getMonth()+1)+"-"+i(e.getDate())}function o(e){var t=d.exec(e);if(t===null||t.length<4)return console.log("failed to parse an ISO date from ",e),undefined;var n=parseInt(t[1]),r=parseInt(t[2].replace(/^0*/,""))-1,i=parseInt(t[3].replace(/^0*/,""));return!n||!r||!i?(console.log("failed to parse an ISO date from ",e),undefined):new Date(n,r,i,0,0,0,0)}function u(e){var t=new Date(e),n=t.getDay();return t.setDate(t.getDate()-(n?n:7)+1),t}function a(e){var t=new Date(e),n=t.getDay();return n&&t.setDate(t.getDate()-n+7),t}function f(e){this.isoDate=s(e),this.display={day:v[e.getDay()],date:e.getDate()+"."+i(e.getMonth()+1)},this.lectures=[];var t=new h.Emitter;this.on=r(this,t.on),this.emit=r(this,t.emit),this.off=r(this,t.off)}function l(e){var t=this.monday=u(e),n=this.sunday=a(e),r=this.days=[];for(var i=new Date(t);i<=n;i.setDate(i.getDate()+1))r.push(new f(i))}function c(e){function t(e){e.date||console.error("can't add a lecture without date!");var t=i(e.date),n=t.add(e);w("lecture.add",e,t,n)}function n(e){e.date||console.error("can't remove lecture without a date!");var t=i(e.date),n=t.remove(e);w("lecture.remove",e,t,n)}function i(e){var t=o(e),n;if(!g&&!y)n=s(t);else{while(g>t)n=u();while(y<t)n=a();if(!n){var r=0;do n=m[r++];while(!n.contains(t))}}return n&&n.day(t)}function s(e){var t=new l(e);return m.push(t),g=new Date(t.monday),y=new Date(t.sunday),w("week.append",t),t}function u(){g.setDate(g.getDate()-7);var e=new l(g);return m.splice(0,0,e),w("week.prepend",e),e}function a(){y.setDate(y.getDate()+7);var e=new l(y);return m.push(e),w("week.append",e),e}function f(){E.weeks=m=[],g=y=undefined,w("clear")}function c(e){m.length&&f();var n=w;w=function(){};if(e&&e.length)for(var r=0,i=e.length;r<i;r++)t(e[r]);if(p&&p.viewport){m.length||s(new Date);while(m.length<p.viewport)a()}w=n,w("init")}function d(){var e=[];for(var t=0,n=m.length;t<n;t++)for(var r=0,i=m[t].days.length;r<i;r++)for(var s=0,o=m[t].days[r].lectures.length;s<o;s++)e.push(m[t].days[r].lectures[s]);return e}var v=[],m=[],g,y,b=new h.Emitter,w=r(this,b.emit),E=this;this.weeks=m,this.appendWeek=a,this.prependWeek=u,this.lectures=d,this.add=t,this.remove=n,this.init=c,this.on=r(this,b.on),this.off=r(this,b.off),c(e)}var h=e("./events"),p=n.config(),d=/\s*(\d+)-(\d+)-(\d+)\s*/,v=["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"];f.prototype.add=function(e){var t=this.lectures,n=t.length,r=0;while(r<n&&t[r].start<e.start)r++;return t.splice(r,0,e),this.emit("add",r,e),r},f.prototype.remove=function(e){var t=this.lectures,n=t.length,r=0;while(r<n&&t[r]!==e)r++;return r<n?(this.emit("remove",r,t.splice(r,1)),r):-1},l.prototype.contains=function(e){return this.monday<=e&&this.sunday>=e},l.prototype.day=function(e){if(this.contains(e))return this.days[(e.getDay()+6)%7]},t.Model=c}),define("js/global",["require"],function(e){return window}),define("js/storage",["require","exports","module","./global"],function(e,t,n){function r(e){return typeof e=="string"?e:o.stringify(e)}function i(e){return e?o.parse(e):e}var s=e("./global"),o=s.JSON,u=s.localStorage;u&&o?(t.supported=!0,t.has=function(e){return typeof u.getItem(e)=="string"},t.get=function(e){return i(u.getItem(e))},t.set=function(e,t){u.setItem(e,r(t))},t.remove=function(e){u.removeItem(e)}):t.supported=!1}),define("js/templates",["require","exports","module","handlebars","./events"],function(e,t,n){function r(e){if(!Handlebars){console.error("Handlebars is missing from the global scope");return}var n,r={"(":"{",")":"}"};while(n=u.exec(e))for(var i=0,s=n.length;i<s;i++)t[n[1]]=Handlebars.compile(n[2].replace(/[\(\)]/g,function(e){return r[e]||e})),o.check()}e("handlebars");var i=e("./events"),s=n.config().required,o=new i.Promise(function(){if(!s&&!s.length)return!0;for(var e=0,n=s.length;e<n;e++)if(!t[s[e]])return!1;return!0}),u=/<!--\s*([\w$-]+)\s*-->\s*([\s\S]+?)\s*(?=<!--\s*[\w$-]+\s*-->|$)/g;e(["text!templates/templates.html"],function(e){e&&r(e)}),t.ready=o}),define("js/ui/layout",["require","exports","module","jquery","js/templates","js/events"],function(e,t,n){function r(e,t){var n=u(a.day(t)),r=n.find(".b-curriculum__lectures-list");_dayLectures[t.isoDate]=r,u.each(t.lectures,function(e,t){c.add(r,t,-1)}),e.append(n),l.emit.call(n,"new.day",t)}function i(e,t,n){n=n||"append";var i=u(a.week(t));u.each(t.days,function(e,t){r(i,t)}),e[n](i),l.emit.call(i,"new.week",t)}function s(e,t){u.each(t.weeks,function(t,n){i(e,n)}),l.emit.call(e,"init",t)}function o(e){a.ready.success(function(){if(!e.weeks.length)return;if(!p||!p["static"])e.on("clear",function(){_dayLectures=[],h.empty(),l.emit.call(h,"clear")}),e.on("init",function(){s(h,this)}),e.on("week.prepend",function(e){i(h,e,"prepend")}),e.on("week.append",function(e){i(h,e,"append")}),e.on("lecture.add",function(e,t,n){c.add(_dayLectures[t.isoDate],e,n)}),e.on("lecture.remove",function(e,t,n){c.remove(_dayLectures[t.isoDate],e,n)});s(h,e)})}var u=e("jquery"),a=e("js/templates"),f=e("js/events"),l=new f.Emitter,c={add:function(e,t,n){var r=u(a.lecture(t)),i=e.children();return n>=0&&n<i.length?u(i[n]).before(r):e.append(r),l.emit.call(r,"new.lecture",t),r},remove:function(e,t,n){var r=e.children();n>=0&&n<=r.length&&(u(r[n]).remove(),l.emit.call(e,"removed.lecture",t))}};_dayLectures={};var h=u(".b-curriculum"),p=n.config();t.init=o,t.on=l.on,t.off=l.off}),define("js/print",["require","exports","module","jquery","./model-factory","./storage","./ui/layout"],function(e,t,n){e("jquery");var r=e("./model-factory"),i=e("./storage"),s=e("./ui/layout"),o=i.get("modeldata");o?s.init(new r.Model(o)):$(function(){$("body").addClass("b-page_state_nodata")})})