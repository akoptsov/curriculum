define(["require","exports","module","jquery","./forms","js/events","js/templates","jquery-ui.ru"],function(e,t,n){function l(e,t,n){var s={autoOpen:!1,modal:!0,resizable:!1,width:"auto",maxWidth:600,dialogClass:"b-dialog"},o={};return o.dlg=r(e).dialog(r.extend(!0,s,t)),o.form=new i.Form(o.dlg,n),o}function c(e){return parseInt(e.replace(/^0/,""))}function p(){var e=this.get();if(!e)return[];var t=h.exec(e);return!t||!t.length?[new i.Error("format",this.name,"[http|https|ftp]://...")]:[]}function d(){return r.trim(this.element.val())}function v(){var e=/^\s*([0-2]\d):([0-5]\d)\s*$/.exec(this.get());return e?[]:[new i.Error("format",this.name,"hh:mm")]}function b(e,t){var n=e.form,i=n.validate();i.length?r.each(i,function(e,t){var r=n.fields[t.name].element,i=r.closest(".b-form__field");i.addClass(g).find(y).text(t.message),r.one("focus",function(e){i.removeClass(g).find(y).text("")})}):(r.isFunction(t)&&t(n.get()),e.dlg.dialog("close"))}function w(e){r.isFunction(e)&&e(),r(this).dialog("close")}function E(e,t,n){f(function(){e.form.bind(t),e.dlg.dialog("option",n).dialog("open")})}var r=e("jquery"),i=e("./forms"),s=e("js/events"),o=e("js/templates");e("jquery-ui.ru");var u,a,f=o.ready.success;r.widget("ui.timespinner",r.ui.spinner,{options:{min:0,max:1439,step:1,page:60},_parse:function(e){if(typeof e=="string"){var t=/^\s*([0-2]\d):([0-5]\d)\s*$/.exec(e);if(t){var n=this._int(t[1]),r=this._int(t[2]);if(!isNaN(n)&&!isNaN(r))return n*60+r}}else if(typeof e=="number")return e},_format:function(e){return this._topzero(~~(e/60))+":"+this._topzero(e%60)},_topzero:function(e){return(e<10?"0":"")+e},_int:c});var h=/^\s*(?:https?|ftp):\/\/.+/,m={date:{required:!0,init:function(){this.element.datepicker({showButtonPanel:!0,showOn:"button",dateFormat:"yy-mm-dd"})}},start:{required:!0,init:function(){this.element.timespinner()},validate:v},end:{required:!0,init:function(){this.element.timespinner()},validate:v},title:{required:!0,get:d},person:{required:!0,get:d},points:{get:d},presentation:{get:d,validate:p},video:{get:d,validate:p}},g="b-form__field_state_invalid",y=".b-form__field-error-message";f(function(){u=l(o["dialog-change"](),{},m),a=l(o["dialog-textdata"](),{resizable:!0,width:"auto",maxWidth:1e3},{data:{}})}),t.create=function(e,t,n){E(u,t,{title:"Новая лекция",buttons:[{text:"ОК",click:function(){b(u,n)}},{text:"Отмена",click:w}]})},t.change=function(e,t,n,r){E(u,t,{title:"Изменить информацию",buttons:[{text:"ОК",click:function(){b(u,n)}},{text:"Отмена",click:w},{text:"Удалить",click:function(){w.call(this,r)}}]})},t.getJSON=function(e){E(a,{},{title:"Создать из JSON",buttons:[{text:"ОК",click:function(){b(a,e)}},{text:"Отмена",click:w}]})},t.provideJSON=function(e){E(a,{data:e},{title:"Расписание в формате JSON",buttons:[{text:"ОК",click:w}]})}})